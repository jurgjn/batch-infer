Bootstrap: docker
From: nvidia/cuda:12.8.0-base-ubuntu24.04
Stage: spython-base

%post
DEBIAN_FRONTEND=noninteractive \
apt-get update --quiet \
&& apt-get install --yes --quiet python3.12 python3-pip python3.12-venv python3.12-dev \
&& apt-get install --yes --quiet git wget gcc g++ make zlib1g-dev zstd

python3 -m venv /bioemu_venv
PATH="/bioemu_venv/bin:$PATH"

pip3 install --no-cache-dir --upgrade pip

pip3 install --no-cache-dir setuptools \
&& pip3 install --no-cache-dir bioemu==1.1.0

# > The first time bioemu is used to sample structures, it will also setup Colabfold on a separate virtual environment for MSA and embedding generation.
BIOEMU_COLABFOLD_DIR=/colabfold

# > To run a tiny test using the default model parameters and denoising settings:
python -m bioemu.sample --sequence GYDPETGTWG --num_samples 10 --output_dir /test-chignolin

%environment
export PATH="/bioemu_venv/bin:$PATH"
export BIOEMU_COLABFOLD_DIR=/colabfold
%runscript
exec python "$@"
%startscript
exec python "$@"
